const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelfSnappingEngine-BK_izlDY.js","assets/index-B9tlkxep.js","assets/vendor-0HVaVRtn.js","assets/index-CDFczaSZ.css","assets/quantityUtils-CG7P4fJy.js","assets/elevationInfoUtils-dlMESJD1.js","assets/hitTestSelectUtils-B84hccaE.js","assets/projectVectorToVector-aG9NiHRz.js","assets/projectPointToVector-B17Wmtmh.js","assets/geodesicUtils-CYEBgZ2g.js","assets/plane-RQwHz28_.js","assets/mat3f64-q3fE-ZOt.js","assets/mat4f64-Dk4dwAN8.js","assets/quatf64-aQ5IuZRd.js","assets/sphere-DVj-u88H.js","assets/geodesicLengthMeasurementUtils-B1cBWWMu.js","assets/geometryEngine-DWLPtR_7.js","assets/geometryEngineBase-C-gsyNi-.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/hydrated-O8bvvGs4.js","assets/GraphicsLayer-Y9k8vrN-.js","assets/Stop-D0IQ6KwQ.js","assets/networkEnums-D-fGefet.js","assets/GridSnappingEngine-uEzpiK1P.js","assets/gridUtils-DZQCubde.js","assets/FeatureSnappingEngine-bjWS6bVO.js","assets/layerViewUtils-CDrrKCPO.js","assets/editingTools-B4WAoKS2.js","assets/SnappingVisualizer2D-CwyPpVes.js","assets/SnappingContext-utvYjb0P.js","assets/PointSnappingHint-W6fYsYXw.js","assets/automaticLengthMeasurementUtils-DWCh1UAq.js","assets/MeshTransform-D69nUWNO.js","assets/quat-Qoau-HDL.js","assets/axisAngleDegrees-C7P8of_4.js","assets/meshVertexSpaceUtils-DsZk72m1.js","assets/MeshLocalVertexSpace-CBQ9UpmK.js","assets/memoize-DmxaQ-k8.js","assets/unitFormatUtils-Dd91Z4TH.js","assets/ByteSizeUnit-BsxeN7wM.js","assets/spatialReferenceEllipsoidUtils-BMhQqhJE.js","assets/earcut-D9gy186-.js","assets/triangle-BfSMbaoS.js","assets/lineSegment-B6sFyjLV.js","assets/editPlaneUtils-CsT6rXXy.js","assets/ReactiveSet-D_xAoheq.js","assets/hydratedFeatures-kNRm6Jt7.js","assets/boundedPlane-C_sbVM_s.js","assets/GraphicManipulator-_9_QczIO.js","assets/drapedUtils-CQlXNzUL.js","assets/drawUtils-BLUAhmL-.js","assets/ImageMaterial.glsl-Br_ddcMj.js","assets/Octree-CEdY9qjP.js","assets/InterleavedLayout-Ch1ew_oX.js","assets/BufferView-UMB8U0MY.js","assets/types-D0PSWh4d.js","assets/RibbonLine.glsl-D0mPmM4-.js","assets/orientedBoundingBox-D4hGsDSi.js","assets/computeTranslationToOriginAndRotation-B1_Qo2HU.js","assets/Geometry-rbFoZBgz.js","assets/renderState-L9YAGscx.js","assets/basicInterfaces-CZwQPxTp.js","assets/ShaderOutput-DnYY5J1_.js","assets/BindType-BBwFZqyN.js","assets/glsl-BH37Aalp.js","assets/VertexAttribute-Cq4MnHjR.js","assets/requestImageUtils-BVz-PCzD.js","assets/TextureFormat-1mYWTFa-.js","assets/Indices-ByIf1rnY.js","assets/dehydratedFeatureUtils-Ypn-aUFS.js","assets/doublePrecisionUtils-B0owpBza.js","assets/vec3f32-nZdmKIgz.js","assets/floatRGBA-C-404vFF.js","assets/ShaderBuilder-43gLbQXK.js","assets/DefaultLayouts-CtS6GvXT.js","assets/triangulationUtils-BveuyviX.js","assets/deduplicate-BCBE9PoF.js","assets/HUDMaterial.glsl-BVdvwlOn.js","assets/VertexArrayObject-Z0flarmS.js","assets/memoryEstimations-CfiaYUy-.js","assets/VertexElementDescriptor-BLyltQyJ.js","assets/NestedMap-CImDozOA.js","assets/glUtil-B2OhhYkz.js","assets/IntersectorInterfaces-CmNINbyF.js","assets/SelectedVertexTooltipInfo-3IaskUqZ.js","assets/TranslateTooltipInfo-CLK7YUWM.js","assets/persistable-B8LiaHwa.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/resourceExtension-D06lrXAA.js","assets/ExtentScaleTooltipInfo-6gkI277o.js","assets/LineCallout.glsl-CUS5qaeN.js","assets/dehydratedFeatures-Cn1fMp4k.js","assets/LodResources-DzH9G927.js","assets/edgeUtils-Bo8ex8pn.js","assets/NormalAttribute.glsl-BFtk7CoR.js","assets/RealisticTree.glsl-BDHjW-XL.js","assets/OptimizedFeature-BRI6IeKu.js","assets/OptimizedGeometry-3yaiiwEe.js","assets/optimizedFeatureQueryEngineAdapter-xCBljxqj.js","assets/featureConversionUtils-BXK7il35.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/PooledRBush-BooisIqG.js","assets/popupUtils-CCnPghHD.js","assets/geometryServiceUtils-CdBU2Ea-.js","assets/project-C4QH6RtY.js","assets/LayerView-BjAoaScD.js","assets/Container-5k0Lq3gq.js","assets/GraphicMover-C6uCP75p.js","assets/featureUtils-CIZ1kUrn.js","assets/Box-PP4S23ay.js","assets/settings-B9X2yw-B.js","assets/Reshape-BsF5MwpP.js"])))=>i.map(i=>d[i]);
import{dv as se,a6 as V,a0 as h,a1 as c,a2 as $,ab as Le,c as Ke,X as Ze,er as We,et as ze,H as q,jE as Xe,U as re,mj as Qe,aB as Je,hk as et,iI as tt,dS as ve,cK as U,di as J,eb as at,fz as it,_ as G,A as ne,cU as ye,e3 as ot,j9 as st,hG as rt,g8 as xe,fb as _e,fd as nt,f9 as pt,pz as lt,pA as ht,cG as be,cQ as N,cP as ct,jb as pe,bf as Ee,ah as dt,cR as ut,cS as yt,cT as gt,pB as vt,jy as mt,gb as w,kI as we,pC as R,gl as Se,s as ft,io as Te,gr as _t,hg as Oe,nD as Y,ga as bt,cL as Et}from"./index-B9tlkxep.js";import{h as Ue}from"./GraphicsLayer-Y9k8vrN-.js";import{a as wt,j as St,T as Tt,w as Ot}from"./Stop-D0IQ6KwQ.js";import{v as $e,l as Gt,f as Mt,x as Pt,j as ge}from"./elevationInfoUtils-dlMESJD1.js";import{p as ae,i as C,z as Rt,A,B as k,L as Ct,g as At,C as kt,R as Ve,n as Ne,D as Dt,F as Fe,G as It,s as Ge,H as K,b as le,K as Me,E as Ht,u as Lt,l as je,O as xt,v as Ut,m as b,P as $t,Q as Vt,S as Nt}from"./hitTestSelectUtils-B84hccaE.js";import{e as Ft}from"./projectVectorToVector-aG9NiHRz.js";function Pe(e){switch(e){case f.SUPPORTED:break;case f.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case f.GEOMETRY_MISSING:return"no geometry";case f.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case f.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case f.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var f;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(f||(f={}));function jt(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return f.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return f.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return f.GEOMETRY_TYPE_UNSUPPORTED}const a=e.elevationInfo;return $e(a)?f.ELEVATION_MODE_UNSUPPORTED:f.SUPPORTED}function Yt(e){return Bt(e).result}function Bt(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:f.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:f.GEOMETRY_MISSING};if($e(e.elevationInfo))return{result:f.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,a=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:f.SUPPORTED,geometry:a}:{result:f.GEOMETRY_TYPE_UNSUPPORTED}}function qt(e){if(e.layer?.type!=="graphics")return f.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return f.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return f.SUPPORTED;default:return f.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(a=>a.type==="object")?f.SYMBOL_TYPE_UNSUPPORTED:Gt(e)!=="on-the-ground"&&Mt(e)?f.ELEVATION_MODE_UNSUPPORTED:f.SUPPORTED}function Re(e,t,a){if(!t||!e?.map)return;const{map:i}=e;i.layers.find(s=>s===t)||i.add(t,a)}function wa(e,t){const a=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(i=>{const o=i.layer;return o===a||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(a)})}let L=class extends se{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new V}};h([c({constructOnly:!0})],L.prototype,"layer",void 0),h([c()],L.prototype,"enabled",void 0),h([c()],L.prototype,"updating",void 0),h([c()],L.prototype,"availability",void 0),h([c()],L.prototype,"sublayerSources",void 0),L=h([$("esri.views.interactive.snapping.FeatureSnappingLayerSource")],L);const Ye=L;let S=class extends se{constructor(t){super(t),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new V,this.distance=ae.distance,this.touchSensitivityMultiplier=ae.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const t=this.featureSources;t.some(Ce)&&Le.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const a=t.filter(Zt),i=this._get("_effectiveFeatureSources")?.filter(Ce)??new V;for(const l of a){const n=i.find(d=>d.layer===l.layer.parent);if(n)n.sublayerSources.includes(l)||n.sublayerSources.add(l);else if(l.layer.parent){const d=new Ye({layer:l.layer.parent});d.sublayerSources.add(l),i.add(d)}}for(const l of i){const n=l.sublayerSources.filter(d=>!a.includes(d));l.sublayerSources.removeMany(n)}i.removeMany(i.filter(l=>l.sublayerSources.length===0));const o=t.filter(Kt),s=this._get("_effectiveFeatureSources")??new V,{added:p,removed:r}=Ke(s.toArray(),[...o,...i]);return s.removeMany(r),s.addMany(p),s}};h([c()],S.prototype,"enabled",void 0),h([c()],S.prototype,"enabledToggled",void 0),h([c()],S.prototype,"forceDisabled",void 0),h([c()],S.prototype,"selfEnabled",void 0),h([c()],S.prototype,"featureEnabled",void 0),h([c()],S.prototype,"gridEnabled",void 0),h([c()],S.prototype,"attributeRulesEnabled",void 0),h([c({type:V.ofType(Ye)})],S.prototype,"featureSources",void 0),h([c()],S.prototype,"distance",void 0),h([c()],S.prototype,"touchSensitivityMultiplier",void 0),h([c({readOnly:!0})],S.prototype,"effectiveEnabled",null),h([c({readOnly:!0})],S.prototype,"effectiveGridEnabled",null),h([c({readOnly:!0})],S.prototype,"effectiveSelfEnabled",null),h([c({readOnly:!0})],S.prototype,"effectiveFeatureEnabled",null),h([c({readOnly:!0})],S.prototype,"_effectiveFeatureSources",null),S=h([$("esri.views.interactive.snapping.SnappingOptions")],S);const me=S;function Ce(e){return e.layer.type==="subtype-group"}function Kt(e){return e.layer.type!=="subtype-group"}function Zt(e){return e.layer.type==="subtype-sublayer"}class j{constructor(t,a,i,o){this.targetPoint=t,this.constraint=a,this.isDraped=i,this.domain=o}}let Be=class extends j{constructor({targetPoint:t,objectId:a,constraint:i,isDraped:o}){super(t,i,o,C.FEATURE),this.objectId=a}},Wt=class extends Be{constructor(t){super({...t,isDraped:!0,constraint:new Rt(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new A(k.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},zt=class extends Be{constructor(t){super({...t,constraint:new Ct(t.edgeStart,t.edgeEnd)})}get hints(){return[new A(k.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ee=class extends j{constructor(t,a,i,o){super(t,new At(t),o,C.ALL),this.first=a,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new kt(this.targetPoint,this.isDraped,this.domain)]}};class Xt extends j{constructor({lineStart:t,lineEnd:a,targetPoint:i,isDraped:o}){super(i,new Ve(t,a),o,C.SELF),this._referenceLineHint=new A(k.REFERENCE_EXTENSION,t,a,o,this.domain)}get hints(){return[this._referenceLineHint,new A(k.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}let Qt=class extends j{constructor({referenceLine:t,lineStart:a,targetPoint:i,isDraped:o}){const s=Ze(a),{left:p,right:r}=t;We(s,ze(s,s,r),p),super(i,new Ve(a,Ne(s)),o,C.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new A(k.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Dt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(t=>new A(k.REFERENCE,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const a={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{q(t.right,i.edge.left)&&(i.fadeLeft=!1,a.fadeRight=!1),q(t.right,i.edge.right)&&(i.fadeRight=!1,a.fadeRight=!1),q(t.left,i.edge.right)&&(i.fadeRight=!1,a.fadeLeft=!1),q(t.left,i.edge.left)&&(i.fadeLeft=!1,a.fadeLeft=!1)}),this._referenceLines.push(a)}},Jt=class extends j{constructor({targetPoint:t,constraint:a,previousVertex:i,otherVertex:o,otherVertexType:s,isDraped:p,selfSnappingType:r,objectId:l,domain:n}){super(t,a,p,n??C.SELF),this.previousVertex=i,this.otherVertex=o,this.otherVertexType=s,this.selfSnappingType=r??oe.None,this.objectId=l??null}get hints(){const t=this.previousVertex,a=this.otherVertexType===ie.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===ie.CENTER?this.targetPoint:this.otherVertex;return[new A(k.TARGET,a,i,this.isDraped,this.domain),new A(k.REFERENCE,t,a,this.isDraped,this.domain),new Fe(this.previousVertex,a,i,this.isDraped,this.domain)]}};var ie,oe;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(ie||(ie={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(oe||(oe={}));let ea=class extends j{constructor({targetPoint:t,point1:a,point2:i,isDraped:o}){super(t,new It(Ne(Xe(re(),a,i,.5)),.5*Qe(Ge(a),Ge(i))),o,C.SELF),this._p1=a,this._p2=i}get hints(){return[new A(k.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new A(k.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Fe(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function ta(e,t,a,i,o=re()){const s=Je(aa,e);return s[2]=Pt(i,s,t,a)||0,i.renderCoordsHelper.toRenderCoords(s,t,o),o}const aa=re();function ia(e,t,a,i){return i.type==="2d"?(Z.x=e[0],Z.y=e[1],Z.spatialReference=t,i.toScreen(Z)):(ta(e,t,a,i,Ae),i.state.camera.projectToScreen(Ae,he),et(he[0],he[1]))}const Z=Ft(0,0,0,null),Ae=re(),he=tt();let P=class extends ve.EventedMixin(se){constructor(e){super(e),this.options=new me,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=D.MAIN}initialize(){this.addHandles([U(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:a,effectiveFeatureEnabled:i,effectiveGridEnabled:o}=this.options;return{selfEnabled:a,featureEnabled:i,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=at(a=>this._updateEngines(e,t,a))},J),U(()=>this.options,e=>{for(const t of this._engines)t.options=e},it)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,a){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const i=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!i.has("feature")?this._createFeatureSnappingEngine(a):void 0,e.selfEnabled&&!i.has("self")?this._createSelfSnappingEngine(a):void 0,e.gridEnabled&&!i.has("grid")?this._createGridSnappingEngine(a):void 0]);if(a.aborted)for(const s of o)s.status==="fulfilled"&&s.value?.engine.destroy();else{for(const s of o)s.status==="fulfilled"&&s.value&&i.set(s.value.type,s.value.engine);this._engines=Array.from(i.values())}}async _createSelfSnappingEngine(e){const{SelfSnappingEngine:t}=await G(()=>import("./SelfSnappingEngine-BK_izlDY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]));return ne(e),{type:"self",engine:new t({view:this.view,options:this.options})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:a}=await G(()=>import("./GridSnappingEngine-uEzpiK1P.js"),__vite__mapDeps([23,1,2,3,24,9,6,4,7,8,10,11,12,13,14,5,20,21,22]));return ne(e),{type:"grid",engine:new a({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await G(()=>import("./FeatureSnappingEngine-bjWS6bVO.js"),__vite__mapDeps([25,1,2,3,5,6,4,7,8,9,10,11,12,13,14,26,20,21,22]));ne(e);const{view:a,options:i}=this,{spatialReference:o}=a;return{type:"feature",engine:new t({view:a,options:i,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,a=e*t;return a*a}snap(e){return ra(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:a}=e;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:s}=a,p=ye(o,s);if(p==null)return t;const{view:r}=this,{elevationInfo:l,visualizer:n}=a,d=[],g=K(p,r,l),m=i.constraint.closestTo(g);if(!this._arePointsWithinScreenThreshold(g,m,a)||!de(i,a.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=le(m),d.push(...i.hints);for(const y of this._currentOtherActiveCandidates)de(y,a.drawConstraints)&&(y.targetPoint=le(m),d.push(...y.hints));return n!=null&&this.addHandles(n.draw(d,{spatialReference:s,elevationInfo:na(a),view:r,selfSnappingZ:a.selfSnappingZ}),ce),Me(m,r,t,a)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case D.MAIN:return e;case D.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=D.MAIN}_removeVisualization(){this.removeHandles(ce)}async _snapSinglePoint({point:e,context:t,signal:a}){const{view:i}=this,{elevationInfo:o}=t,s=K(e,i,o),p=await this._fetchCandidates(s,C.ALL,t,a);return this._createSnapResult(s,D.MAIN,p,i,e,t,a)}async _snapMultiPoint({point:e,scenePoint:t,context:a,signal:i}){const{view:o}=this,{coordinateHelper:s,elevationInfo:p,spatialReference:r}=a;await ot(t.spatialReference,r);const l=ye(t,r),n=K(l,o,p),d=await this._fetchCandidates(n,C.FEATURE,a,i);if(d.length>0){const y=await this._fetchCandidates(n,C.SELF,a,i);return this._createSnapResult(n,D.SCENE,[...d,...y],o,l,a,i)}const g=K(e,o,p),m=await this._fetchCandidates(g,C.SELF,a,i);return this._createSnapResult(g,D.MAIN,m,o,{z:s.hasZ()&&e.hasZ?e.z??0:void 0,m:s.hasM()&&e.hasM?e.m??0:void 0},a,i)}async _fetchCandidates(e,t,a,i){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,a,i)))).flat()}_createSnapResult(e,t,a,i,o,s,p){return{get valid(){return!st(p)},apply:()=>{const{spatialReference:r}=s,{snappedPoint:l,hints:n}=this._processCandidates(e,t,a,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(n,{spatialReference:r,elevationInfo:ge,view:i,selfSnappingZ:s.selfSnappingZ}),ce),Me(l,i,o,s)}}}_processCandidates(e,t,a,i){if(a.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Ht(e,a);const o=this._currentMainCandidate;if(o!=null){const s=sa(o,a);if(s>=0){if(!(a[s]instanceof ee))return this._intersectWithOtherCandidates(s,a,e,t,i);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,i))return this._updateSnappingCandidate(o,t,a,i)}}return this._intersectWithOtherCandidates(0,a,e,t,i)}_intersectWithOtherCandidates(e,t,a,i,o){const{coordinateHelper:s}=o,p=t[e],r=[];for(let l=0;l<t.length;++l){if(l===e)continue;const n=t[l],d=p.constraint.intersect(n.constraint);if(d)for(const g of d.closestPoints(p.targetPoint))r.push([new ee(le(g),p,n,n.isDraped),this._squaredScreenDistance(a,g,s)])}return r.length>0&&(r.sort((l,n)=>l[1]-n[1]),r[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(r[0][0],i,t,o):de(p,o.drawConstraints)?this._updateSnappingCandidate(p,i,t,o):{snappedPoint:a,hints:[]}}_updateSnappingCandidate(e,t,a,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const p of a){if(e instanceof ee){if(p.constraint.equals(e.first.constraint)||p.constraint.equals(e.second.constraint))continue}else if(p.constraint.equals(e.constraint))continue;const r=p.constraint.closestTo(o);this._squaredScreenDistance(r,o,i.coordinateHelper)<oa()&&(p.targetPoint=o,this._currentOtherActiveCandidates.push(p),s.push(...p.hints))}return{snappedPoint:o,hints:s}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,a){return this._squaredScreenDistance(e,t,a.coordinateHelper)<this._squaredPointProximityThreshold(a.pointer)}_squaredScreenDistance(e,t,a){return Lt(this._toScreen(e,a),this._toScreen(t,a))}_toScreen(e,t){return ia(e,t.spatialReference,ge,this.view)}get test(){}};var D;h([c({constructOnly:!0})],P.prototype,"view",void 0),h([c()],P.prototype,"options",void 0),h([c({readOnly:!0})],P.prototype,"updating",null),h([c()],P.prototype,"_loadTask",void 0),h([c()],P.prototype,"_engines",void 0),h([c()],P.prototype,"_squaredMouseProximityThreshold",null),h([c()],P.prototype,"_squaredTouchProximityThreshold",null),P=h([$("esri.views.interactive.snapping.SnappingManager")],P),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(D||(D={}));const ce="visualization-handle";function oa(){return ae.satisfiesConstraintScreenThreshold*ae.satisfiesConstraintScreenThreshold}function de(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof Wt||e instanceof zt||e instanceof Xt||e instanceof Qt||e instanceof ea)&&(!(e instanceof Jt)||t.direction==null&&e.selfSnappingType===oe.LastVertex)}function sa(e,t){return e instanceof ee?ue(t,e.first)>=0&&ue(t,e.second)>=0?0:-1:ue(t,e)}function ue(e,t){let a=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){a=i;break}return a}function ra(e){return e.scenePoint!=null}function na({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?ge:t}let T=class extends ve.EventedAccessor{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:rt(this.activeComponent)}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const t=this.activeComponent;t&&(t.type!=="box"&&t.type!=="reshape"&&t.type!=="graphic-mover"||t.refresh())}set undo(t){this._set("undo",()=>{this.canUndo()&&t()})}set redo(t){this._set("redo",()=>{this.canRedo()&&t()})}};h([c()],T.prototype,"activeComponent",void 0),h([c()],T.prototype,"cancelled",void 0),h([c()],T.prototype,"history",void 0),h([c()],T.prototype,"tool",null),h([c()],T.prototype,"type",void 0),h([c()],T.prototype,"canUndo",null),h([c()],T.prototype,"canRedo",null),h([c()],T.prototype,"onEnd",void 0),h([c()],T.prototype,"undo",null),h([c()],T.prototype,"redo",null),h([c()],T.prototype,"toggleTool",void 0),h([c()],T.prototype,"addToSelection",void 0),h([c()],T.prototype,"removeFromSelection",void 0),T=h([$("esri.widgets.Sketch.support.OperationHandle")],T);let te=class extends T{};h([c()],te.prototype,"activeComponent",void 0),te=h([$("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],te);let I=class extends T{};h([c()],I.prototype,"activeComponent",void 0),I=h([$("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],I);function pa(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function la(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var ke;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(ke||(ke={}));const De={defaultZ:0},B={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let v=class extends ve.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new xe,this._internalGraphicsLayer=new Ue({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new _e({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new nt({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new pt({color:[130,130,130,1],width:2}),this.meshSymbol=new lt({symbolLayers:new V([new ht])}),this.updateGraphics=new V,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new _e({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new je,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=De,this.defaultUpdateOptions=B,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new me}initialize(){this.addHandles([be(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),be(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),U(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},J),U(()=>this.view,e=>{this._defaultSnappingManager=N(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new P({view:e,options:this.snappingOptions})),e.type==="2d"?G(()=>import("./editingTools-B4WAoKS2.js"),__vite__mapDeps([27,1,2,3,28,6,4,7,8,9,10,11,12,13,14,5,29,30,31,32,33,34,35,36,37,38,39,40,15,16,17,18,19,41,42,43,44,20,45,46,47,48,49,50])):e.type==="3d"&&(G(()=>import("./ImageMaterial.glsl-Br_ddcMj.js").then(t=>t.e),__vite__mapDeps([51,1,2,3,5,31,4,32,12,33,11,13,34,35,36,6,7,8,9,10,14,37,38,39,40,15,16,17,18,19,52,53,54,55,43,56,57,58,59,60,61,62,63,64,65,47,66,67,68,42,69,70,46,71,72,73,74,75,41,76,77,78,79,80,81,82,29,30,44,20,45,83,84,85,86,87,88,89,48,49])),G(()=>import("./LineCallout.glsl-CUS5qaeN.js").then(t=>t.G),__vite__mapDeps([90,1,2,3,8,7,5,56,57,11,12,33,13,40,58,10,59,60,61,62,63,64,65,47,14,43,66,67,53,54,55,68,42,69,70,35,36,46,71,52,72,73,91,79,92,83,93,94,95,96,97,98,99,100,101,102,26,103,104,105,106]))))},J),U(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),xt(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=N(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,a=!t&&e&&"tooltip"in e?e.tooltip:null;return a?.visible?a:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...De,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...B,...e,reshapeOptions:{...B.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...B.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=N(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new P({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:i,map:o}=t;i&&(t.cursor=null),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const a="view-ready";this.removeHandles(a),e&&this.addHandles(ct(()=>e.ready,i=>{this.removeHandles(this._viewHandlesKey),i&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},J),a),this._set("view",e)}cancel(){this._moduleLoaderAbortController=pe(this._moduleLoaderAbortController),this._viewReadyAbortController=pe(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:a,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:a})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:a,layer:i}=this;if(!a||this.state==="disabled")throw i||this._logMissingLayer(),Ee();if(a.activeTool!=null&&(a.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Re(a,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void a.map.remove(this._internalGraphicsLayer);const s=()=>{if(o===this._operationHandle){const p=this.createGraphic,r=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||p==null||i.add(p),this._sketchContinuationFlag=!1,this.emit("create",{graphic:p,state:r?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),r||this._sketchContinuationFlag)return;const{creationMode:l}=this;if(l==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(Oe(this.create(e,t)))}else l==="update"&&p&&this._updatingHandles.addPromise(Oe(this.update([p])))}};o.on("complete",s),this._operationHandle=o,a.ready&&a.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:a,view:i,state:o}=this;if(!i||o==="disabled")throw a||this._logMissingLayer(),Ee();i.activeTool!=null&&(i.activeTool=null);const s=Array.isArray(e)?e:[e];if(e==null||!s?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(r=>r.layer!==a?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):r.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const p=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,t));this.destroyed||p==null||E(p)||(Re(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(p,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:p.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const a of e)a.geometry==null||a.geometry.type==="mesh"||dt(a.geometry.spatialReference,t.spatialReference)||(ut(a.geometry.spatialReference,t.spatialReference)||yt()||await gt(),a.geometry=ye(a.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach(p=>{p.type!=="vector-tile"&&p.type!=="imagery"||o.push(p)});const s=await t.hitTest(e,{exclude:o});return Ut(s.results)}const a=[t.map.ground];t.map.allLayers.forEach(o=>{vt(o.type)&&a.push(o)});const i=await t.hitTest(e,{exclude:a});if(i.results.length>0){const o=i.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(o.distance??0)>-Math.min(3*i.ground.distance,t.viewingMode==="global"?mt(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const a=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!a&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},w.WIDGET)]}async _handleImmediateClick(e){const t=await e.async(()=>this._getFirstHit(we(e)));let a=null;if(t!=null){const i=t.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(e.stopPropagation(),a=i):this.view?.type!=="2d"||this._isComponentGraphic(i)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();a==null||this.updateGraphics.includes(a)||await this.update([a],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const a=this.view;if(!a)return this._logMissingView(),null;const i={hasZ:a.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,a,i);return o==null?null:(a.tools.add(o),a.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,a){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:o,hasZ:s,geometryToPlace:p,graphicProperties:r,mode:l,preserveAspectRatio:n}=a,d=pa(l,e),g=la(e),m=a?.optionsPerTool?.has(e)?a.optionsPerTool.get(e):{},y=m?.preserveAspectRatio??n??e!=="rectangle",u={centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:i,defaultZ:o,forceUniformSize:y,graphicProperties:{...r,attributes:{...r?.attributes}},geometryToPlace:p,geometryType:g,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:t,...m};return t.type==="2d"?this._makeDrawGraphicTool2D(u):this._makeDrawGraphicTool3D(u)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(G(()=>import("./editingTools-B4WAoKS2.js"),__vite__mapDeps([27,1,2,3,28,6,4,7,8,9,10,11,12,13,14,5,29,30,31,32,33,34,35,36,37,38,39,40,15,16,17,18,19,41,42,43,44,20,45,46,47,48,49,50])));return E(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:ca(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(G(()=>import("./ImageMaterial.glsl-Br_ddcMj.js").then(i=>i.e),__vite__mapDeps([51,1,2,3,5,31,4,32,12,33,11,13,34,35,36,6,7,8,9,10,14,37,38,39,40,15,16,17,18,19,52,53,54,55,43,56,57,58,59,60,61,62,63,64,65,47,66,67,68,42,69,70,46,71,72,73,74,75,41,76,77,78,79,80,81,82,29,30,44,20,45,83,84,85,86,87,88,89,48,49])));if(E(t)||this.destroyed)return null;const{elevationInfo:a}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:a,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let a=null;const i=e.forceUniformSize,o=e.centered,s=[t.on("key-down",r=>{if(r.key===b.pan)r.stopPropagation(),r.repeat||(e.enabled=!1);else if(r.key===b.complete)r.stopPropagation(),e.completeCreateOperation();else if(r.key!==b.vertexAdd||r.repeat)r.key===b.undo?(r.stopPropagation(),p.undo()):r.key===b.redo?(r.stopPropagation(),p.redo()):r.key!==b.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||r.repeat?r.key===b.center&&(r.repeat||(e.centered=!o,r.stopPropagation())):(e.forceUniformSize=!i,r.stopPropagation());else{const l=e.drawOperation.geometryType;l!=="polyline"&&l!=="polygon"&&l!=="multipoint"||(r.stopPropagation(),e.drawOperation.commitStagedVertex())}},w.WIDGET),t.on("key-up",r=>{r.key===b.pan?e.enabled=!0:r.key!==b.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?r.key===b.center&&(e.centered=o,r.stopPropagation()):(e.forceUniformSize=i,r.stopPropagation())},w.WIDGET),e.on("vertex-add",r=>{switch(a=a==null?"start":"active",r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:a,tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",r=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:r.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",r=>{switch(r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",r=>{this._set("createGraphic",r.graphic),a="complete",r.aborted?p&&p.cancel():p&&p.complete()}),U(()=>this._getGraphicSymbolFromTool(e.geometryType),r=>{e.graphicSymbol=r})],p=new te({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{R(s),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return p}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:a,view:i}=this;if(!i)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let s=o.tool??B.tool;for(const p of e)a.remove(p),a.add(p);if(i.type==="3d"){if(e.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(e,o,i,s);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,i);case"transform":return this._setupGraphicTransform3DOperation(e,o,i)}}switch(s){case"move":return this._setupMove2DOperation(e,o,i);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,s,o,i);case"transform":if(e.length===1){const p=e[0].geometry?.type;p!=="point"&&p!=="multipoint"||(s="reshape")}return this._setupTransformOrReshape2DOperation(e,s,o,i)}}async _setupMove3DOperation(e,t,a,i,o=!1){const s=await this._requireModule(G(()=>import("./ImageMaterial.glsl-Br_ddcMj.js").then(y=>y.e),__vite__mapDeps([51,1,2,3,5,31,4,32,12,33,11,13,34,35,36,6,7,8,9,10,14,37,38,39,40,15,16,17,18,19,52,53,54,55,43,56,57,58,59,60,61,62,63,64,65,47,66,67,68,42,69,70,46,71,72,73,74,75,41,76,77,78,79,80,81,82,29,30,44,20,45,83,84,85,86,87,88,89,48,49])));if(E(s))return s;const{ManipulatedObject3DGraphic:p,MoveTool3D:r}=s.module,l=new Map,n=()=>{l.forEach(y=>y.destroy()),l.clear()};for(const y of e){const u=new p({view:a,graphic:y}),O=jt(u);if(O!==f.SUPPORTED)return n(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Pe(O)}).`),null;l.set(y,u)}const d=new r({view:a,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(d),d.objects.addMany(Array.from(l.values())),o||this.updateGraphics.addMany(e);const g=[],m=new I({activeComponent:d,tool:i,type:"update",onEnd:()=>{R(g),X(a,d),n()},undo:()=>{He(this.view,d),W(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{z(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:y=>{this.updateGraphics.push(y);const u=new p({view:a,graphic:y});l.set(y,u),d.objects.push(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:y=>{const u=this.updateGraphics.indexOf(y);if(m.history.undo.forEach(M=>M.updates.splice(u,1)),m.history.redo.forEach(M=>M.updates.splice(u,1)),this.updateGraphics.remove(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void m.complete();const O=l.get(y);O&&(d.objects.remove(O),O.destroy(),l.delete(y))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||i!=="transform")return;const y=this.updateGraphics.at(0),u=await this._setupReshape3DOperation(y,t,a,!0);u&&!E(u)&&(m.onEnd(),m.destroy(),this._setUpdateOperationHandle(u,t))}});return g.push(...this._getHandlesForComponent(m,t),a.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(m,y,t),w.WIDGET),a.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(m,y)},w.WIDGET)),m}_setupGraphicTransform3DOperation(e,t,a,i=!1){if(e.length===1&&qt(e[0])===f.SUPPORTED){const o=e[0],s=o.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(o,t,a);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,a,i)}return this._setupMove3DOperation(e,t,a,"transform",i)}async _setupPointTransform3DOperation(e,t,a){const i="transform",{enableRotation:o,enableScaling:s,enableZ:p}=t,r=await this._requireModule(G(()=>import("./ImageMaterial.glsl-Br_ddcMj.js").then(u=>u.e),__vite__mapDeps([51,1,2,3,5,31,4,32,12,33,11,13,34,35,36,6,7,8,9,10,14,37,38,39,40,15,16,17,18,19,52,53,54,55,43,56,57,58,59,60,61,62,63,64,65,47,66,67,68,42,69,70,46,71,72,73,74,75,41,76,77,78,79,80,81,82,29,30,44,20,45,83,84,85,86,87,88,89,48,49])));if(E(r))return r;const{TransformTool3D:l,ManipulatedObject3DGraphic:n}=r.module,d=new n({graphic:e,view:a}),g=new l({object:d,view:a,enableRotation:o,enableScaling:s,enableZ:p,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(g),this.updateGraphics.add(e);const m=[],y=new I({activeComponent:g,tool:i,type:"update",onEnd:()=>{R(m),X(a,g),d.destroy()},undo:()=>{He(this.view,g),W(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{z(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async u=>{this.updateGraphics.add(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);E(O)||this._setUpdateOperationHandle(O,t)},removeFromSelection:u=>{this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return m.push(...this._getHandlesForComponent(y,t),a.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(y,u,t),w.WIDGET),a.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(y,u)},w.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,a,i=!1){const o="transform",{enableRotation:s,enableScaling:p,enableZ:r,preserveAspectRatio:l}=t,n=await this._requireModule(G(()=>import("./ImageMaterial.glsl-Br_ddcMj.js").then(_=>_.e),__vite__mapDeps([51,1,2,3,5,31,4,32,12,33,11,13,34,35,36,6,7,8,9,10,14,37,38,39,40,15,16,17,18,19,52,53,54,55,43,56,57,58,59,60,61,62,63,64,65,47,66,67,68,42,69,70,46,71,72,73,74,75,41,76,77,78,79,80,81,82,29,30,44,20,45,83,84,85,86,87,88,89,48,49])));if(E(n))return n;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:g}=n.module,m=this.view?.inputManager?.isModifierKeyDown(b.constraint),y=new d({view:a,graphic:e}),u=new g({object:y,view:a,enableRotation:s,enableScaling:p,enableZ:r,preserveAspectRatio:!!l!=!!m,sketchOptions:this.sketchOptions});a.tools.add(u),i||this.updateGraphics.add(e);const O=[],M=new I({activeComponent:u,tool:o,type:"update",onEnd:()=>{R(O),X(a,u),y.destroy()},canUndo:()=>!u.destroyed&&u.canUndo,undo:()=>{u.destroyed||(u.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!u.destroyed&&u.canRedo,redo:()=>{u.destroyed||(u.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),M.onEnd(),M.destroy();const fe=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);E(fe)||this._setUpdateOperationHandle(fe,t)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),M.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const _=await this._setupReshape3DOperation(e,t,a,!0);_&&!E(_)&&(M.onEnd(),M.destroy(),this._setUpdateOperationHandle(_,t))}});return O.push(...this._getHandlesForComponent(M,t),a.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(M,_,t),w.WIDGET),a.on("key-down",_=>this._getCommonUpdateOperationKeyDownHandlers(M,_),w.WIDGET),a.on("key-down",_=>{_.key!==b.constraint||_.repeat||(u.preserveAspectRatio=!u.preserveAspectRatio,_.stopPropagation())},w.WIDGET),a.on("key-up",_=>{_.key===b.constraint&&(u.preserveAspectRatio=!u.preserveAspectRatio,_.stopPropagation())},w.WIDGET)),M}async _setupMove2DOperation(e,t,a){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,a);if(E(o))return o;const s=new I({activeComponent:o,tool:i,type:"update",onEnd:()=>{this._displayDefaultCursor(),R(l),R(r),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const n=this.updateGraphics.toArray();W(s,n),s.refreshComponent(),this._emitUndoEvent({graphics:n,tool:i})},redo:()=>{const n=this.updateGraphics.toArray();z(s,n),s.refreshComponent(),this._emitRedoEvent({graphics:n,tool:i})},addToSelection:async n=>{await this._updatingHandles.addPromise(this._updateSpatialReference(n)),this.updateGraphics.push(n),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{const d=this.updateGraphics.indexOf(n);s.history.undo.forEach(m=>m.updates.splice(d,1)),s.history.redo.forEach(m=>m.updates.splice(d,1)),this.updateGraphics.remove(n);const g=this.updateGraphics.toArray();this.emit("update",{graphics:g,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=g:s.complete()}});let p=!1;const r=[a.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(s,n,t),w.WIDGET),a.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(s,n),n.key!==b.constraint||n.repeat||(p=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},w.WIDGET),a.on("key-up",n=>{n.key===b.constraint&&p&&(p=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},w.WIDGET)],l=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,a,i=!1){const o="reshape",s=await this._requireModule(G(()=>import("./ImageMaterial.glsl-Br_ddcMj.js").then(u=>u.e),__vite__mapDeps([51,1,2,3,5,31,4,32,12,33,11,13,34,35,36,6,7,8,9,10,14,37,38,39,40,15,16,17,18,19,52,53,54,55,43,56,57,58,59,60,61,62,63,64,65,47,66,67,68,42,69,70,46,71,72,73,74,75,41,76,77,78,79,80,81,82,29,30,44,20,45,83,84,85,86,87,88,89,48,49])));if(E(s))return s;const{ManipulatedObject3DGraphic:p,ReshapeTool3D:r}=s.module,l=new p({view:a,graphic:e}),n=Yt(l);if(n!==f.SUPPORTED)return l.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Pe(n)}).`),null;const d=t.reshapeOptions,g=new r({view:a,object:l,enableZVertex:t.enableZ&&d?.vertexOperation==="move",enableZShape:t.enableZ&&d?.shapeOperation==="move",enableMoveObject:d?.shapeOperation==="move"||d?.shapeOperation==="move-xy",enableMidpoints:d?.edgeOperation==="split",enableEdgeOffset:d?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(g),i||this.updateGraphics.add(l.graphic);const m=[],y=new I({activeComponent:g,tool:o,type:"update",onEnd:()=>{R(m),X(a,g),l.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async u=>{this.updateGraphics.add(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);E(O)||this._setUpdateOperationHandle(O,t)},removeFromSelection:u=>{this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),y.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;y.onEnd(),y.destroy();const u=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,a,!0);E(u)||this._setUpdateOperationHandle(u,t)}});return m.push(...this._getHandlesForComponent(y,t),a.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(y,u,t),w.WIDGET),a.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(y,u)},w.WIDGET)),y}async _setupTransformOrReshape2DOperation(e,t,a,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,a,i):await this._getReshape(e,a,i);if(E(o))return o;const s=new I({activeComponent:o,type:"update",onEnd:()=>{R(r),R(p),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{W(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{z(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async l=>{let n=s.activeComponent;if(n?.type==="reshape"){const d=[...this.updateGraphics,l];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const g=await this._setupTransformOrReshape2DOperation(d,"transform",a,i);if(E(g))return;this._setUpdateOperationHandle(g,a)}else this.updateGraphics.add(l),n.graphics=this.updateGraphics.toArray(),n.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async l=>{const n=this.updateGraphics.indexOf(l);s.history.undo.forEach(g=>g.updates.splice(n,1)),s.history.redo.forEach(g=>g.updates.splice(n,1)),this.updateGraphics.remove(l);const d=this.updateGraphics.toArray();if(d.length===0)s.complete();else{const g=d[0].geometry;d.length!==1||g==null||g.type!=="point"&&g.type!=="multipoint"?s.activeComponent.graphics=d:s.toggleTool()}this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const l=this.updateGraphics.at(0),n=l.geometry;if(n!=null&&(s.tool==="reshape"&&(n.type==="point"||n.type==="multipoint")||s.tool==="transform"&&n.type==="extent"))return;let d=null;s.tool==="transform"?d=await this._getReshape([l],a,i):s.tool==="reshape"&&(d=await this._getBox([l],a,i)),E(d)||(s.activeComponent?.destroy(),s.activeComponent=d,s.activeComponent&&(R(r),r=this._getHandlesForComponent(s,a)))}}),p=[i.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(s,l,a),w.WIDGET),i.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,l),l.key===b.constraint&&!l.repeat&&s){const n=s.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},w.WIDGET),i.on("key-up",l=>{if(l.key===b.constraint&&s){const n=s.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},w.WIDGET)];let r=this._getHandlesForComponent(s,a);return s}async _getGraphicMover(e,t,a){const{enableMoveAllGraphics:i,highlightOptions:o}=t,s=await this._requireModule(G(()=>import("./GraphicMover-C6uCP75p.js").then(p=>p.G),__vite__mapDeps([107,1,2,3,20,50,26,108,48,8,5,49])));return E(s)?s:new s.module.default({enableMoveAllGraphics:i,highlightsEnabled:!!o?.enabled,indicatorsEnabled:!1,graphics:e,view:a,callbacks:{onGraphicMoveStart:({dx:p,dy:r,graphic:l})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:r,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:p,dy:r,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:r,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:p,dy:r,graphic:l})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:r,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,a){const{enableRotation:i,enableScaling:o,highlightOptions:s,preserveAspectRatio:p}=t,r=await this._requireModule(G(()=>import("./Box-PP4S23ay.js"),__vite__mapDeps([109,1,2,3,4,50,107,20,26,108,48,8,5,49,110,6,7,9,10,11,12,13,14,31,32,33,34,35,36,37,38,39,40,15,16,17,18,19,89,85,21,22])));if(E(r))return r;const l=this.view?.inputManager?.isModifierKeyDown(b.constraint);return new r.module.default({graphics:e,enableRotation:i,enableScaling:o,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!p!=!!l,layer:this._internalGraphicsLayer,view:a,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onMove:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onMoveStop:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onScaleStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onScale:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onScaleStop:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onRotateStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onRotate:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onRotateStop:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"})}})}async _getReshape(e,t,a){const i=t.reshapeOptions?.edgeOperation==="split",o=t.reshapeOptions?.shapeOperation==="move",s=!!t.highlightOptions?.enabled,p=await this._requireModule(G(()=>import("./Reshape-BsF5MwpP.js"),__vite__mapDeps([111,1,2,3,20,28,6,4,7,8,9,10,11,12,13,14,5,29,30,31,32,33,34,35,36,37,38,39,40,15,16,17,18,19,41,42,43,50,107,26,108,48,49,84,85,110,21,22])));return E(p)?p:new p.module.default({enableMidpoints:i,enableMovement:o,graphic:e[0],highlightsEnabled:s,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:a,callbacks:{onReshapeStart:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onReshape:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onReshapeStop:({mover:r,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r,type:l},type:"update"}),onMoveStart:({dx:r,dy:l,mover:n,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:l,mover:n,type:d},type:"update"}),onMove:({dx:r,dy:l,mover:n,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:l,mover:n,type:d},type:"update"}),onMoveStop:({dx:r,dy:l,mover:n,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:l,mover:n,type:d},type:"update"}),onVertexAdd:({added:r,type:l,vertices:n})=>{const d=r.map(g=>Se(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:d,vertices:n,type:l},type:"update"})},onVertexRemove:({removed:r,type:l,vertices:n})=>{const d=r.map(g=>Se(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:d,vertices:n,type:l},type:"update"})}}})}_getHandlesForComponent(e,t){const a=e.activeComponent;if(!a)return[];switch(a.type){case"graphic-mover":return[a.on("graphic-click",({graphic:i,viewEvent:o})=>{o.native?.shiftKey&&(o.stopPropagation(),e.removeFromSelection(i))}),a.on("graphic-move-start",i=>e.addToHistory(H(i.allGraphics)))];case"box":return[a.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),a.on("move-start",i=>e.addToHistory(H(i.graphics))),a.on("rotate-start",i=>e.addToHistory(H(i.graphics))),a.on("scale-start",i=>e.addToHistory(H(i.graphics)))];case"reshape":return[a.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),a.on("move-start",i=>e.addToHistory(H([i.mover]))),a.on("reshape-start",i=>e.addToHistory(H([i.graphic]))),a.on("vertex-add",i=>e.addToHistory(H([i.oldGraphic]))),a.on("vertex-remove",i=>e.addToHistory(H([i.oldGraphic])))];case"move-3d":return[a.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),a.events.on("move-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-start"},type:"update"})}),a.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:i.dx,dy:i.dy,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move"},type:"update"})}),a.events.on("move-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-stop"},type:"update"})}),a.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[a.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),a.events.on("translate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-start"},type:"update"})}),a.events.on("translate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-stop"},type:"update"})}),a.events.on("rotate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-start"},type:"update"})}),a.events.on("rotate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-stop"},type:"update"})}),a.events.on("scale-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-start"},type:"update"})}),a.events.on("scale-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-stop"},type:"update"})}),a.events.on("translate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move"},type:"update"})}),a.events.on("rotate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate"},type:"update"})}),a.events.on("scale",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale"},type:"update"})}),a.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[a.events.on("reshape",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),a.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),a.events.on("vertex-add",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),a.events.on("vertex-remove",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),a.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,a){const{graphic:i,viewEvent:o}=a;return o.native?.shiftKey&&i.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const a=this.view?.map;this._disablePopup(t);const i=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),a&&a.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:s,toolEventInfo:null,type:"update"})}};e.on("complete",i)}async _getCommonUpdateOperationClickHandlers(e,t,a){const i=we(t),o=await t.async(()=>this._getFirstHit(i));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,a))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,a){const i=!!a.multipleSelectionEnabled;return e.some(o=>o!=null&&!(!i||o.layer!==this.layer)&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const a=t.key;a===b.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):a===b.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):a===b.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&b.delete.includes(a)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,a=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||a.length===1&&a[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=N(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,a){Le.getLogger(this).error(new ft(e,t,a))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const a=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:a}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return Te(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(pe(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await _t(Te(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Ie("view"))}_logMissingLayer(){this._logError(ha,Ie("layer"))}};h([c()],v.prototype,"_defaultSnappingManager",void 0),h([c()],v.prototype,"updating",null),h([c({readOnly:!0})],v.prototype,"_updatingHandles",void 0),h([c()],v.prototype,"_operationHandle",void 0),h([c({readOnly:!0})],v.prototype,"activeTool",null),h([c({readOnly:!0})],v.prototype,"activeCreateToolDrawMode",null),h([c()],v.prototype,"activeTooltip",null),h([c({types:Y})],v.prototype,"activeFillSymbol",void 0),h([c()],v.prototype,"activeLineSymbol",void 0),h([c()],v.prototype,"activeVertexSymbol",void 0),h([c()],v.prototype,"allowDeleteKey",void 0),h([c({readOnly:!0})],v.prototype,"createGraphic",null),h([c()],v.prototype,"defaultCreateOptions",null),h([c()],v.prototype,"defaultUpdateOptions",null),h([c({type:$t,nonNullable:!0})],v.prototype,"labelOptions",null),h([c()],v.prototype,"layer",void 0),h([c({types:Y})],v.prototype,"pointSymbol",void 0),h([c({types:Y})],v.prototype,"polygonSymbol",void 0),h([c({types:Y})],v.prototype,"polylineSymbol",void 0),h([c()],v.prototype,"meshSymbol",void 0),h([c({type:me,nonNullable:!0})],v.prototype,"snappingOptions",null),h([c()],v.prototype,"snappingManager",null),h([c({readOnly:!0})],v.prototype,"state",null),h([c({type:Vt,nonNullable:!0})],v.prototype,"tooltipOptions",null),h([c({readOnly:!0})],v.prototype,"updateGraphics",void 0),h([c()],v.prototype,"updateOnGraphicClick",void 0),h([c()],v.prototype,"creationMode",void 0),h([c({type:Nt,nonNullable:!0})],v.prototype,"valueOptions",null),h([c({types:Y})],v.prototype,"vertexSymbol",void 0),h([c({value:null})],v.prototype,"view",null),h([c({constructOnly:!0,type:je})],v.prototype,"sketchOptions",void 0),v=h([$("esri.widgets.Sketch.SketchViewModel")],v);const ha="sketch:missing-property",Ie=e=>`Property '${e}' is missing on SketchViewModel.`;function ca(e){return e==="polygon"||e==="rectangle"||e==="circle"}function W(e,t){qe("undo",e.history.undo,e.history.redo,t)}function z(e,t){qe("redo",e.history.redo,e.history.undo,t)}function qe(e,t,a,i){const o=t.pop();if(!o)return;const s=o.updates,p=[];i.forEach((r,l)=>{const n=s[l];n!=null&&("geometry"in n&&n.geometry!=null&&(p.push({geometry:r.geometry}),r.geometry=n.geometry),"symbol"in n&&n.symbol!=null&&(p.push({symbol:r.symbol}),r.symbol=n.symbol),"undo"in n&&(p.push(n),n[e](r)))}),a.push({updates:p})}function He(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function H(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function X(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function E(e){return"requireError"in e&&e.requireError==="aborted"}const da=v;function Q(e,t){e.networkFeature=t}function ua(e){const t=F(e.graphic);return{...e,networkFeature:t}}function ya(e){const t=e.graphics.map(a=>F(a));return{...e,networkFeatures:t}}function F(e){return e.networkFeature}function ga(e){return e?.type==="point"||e?.type==="polyline"||e?.type==="polygon"}let x=class extends se{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new Ue({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new xe,this.enabled=!0,this._handleSketchViewModelEvents=async t=>{switch(t.type){case"update":switch(t.state){case"active":case"complete":for(const a of t.graphics)F(a).geometry=ga(a.geometry)?a.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const a of t.graphics){const i=F(a);this._removeNetworkFeature(i)}break;case"create":if(t.graphic&&t.state==="complete"&&this._createMode){const a=t.graphic.geometry?.clone(),i=t.graphic.symbol?.clone();if(!a)break;switch(this._createMode){case"stop":{if(a.type!=="point")break;const{stops:o}=this.layer;if(o.length>0&&o.every(({geometry:p})=>!p)){o.at(0).geometry=a;break}if(o.length>1&&o.filter((p,r)=>r!==0).every(({geometry:p})=>!p)){o.at(1).geometry=a;break}const s=new Ot({geometry:a});o.add(s),Q(t.graphic,s);break}case"point-barrier":{if(a.type!=="point")break;const o=new Tt({geometry:a,symbol:i});this.layer.pointBarriers.add(o),Q(t.graphic,o);break}case"polyline-barrier":{if(a.type!=="polyline")break;const o=new St({geometry:a,symbol:i});this.layer.polylineBarriers.add(o),Q(t.graphic,o);break}case"polygon-barrier":{if(a.type!=="polygon")break;const o=new wt({geometry:a,symbol:i});this.layer.polygonBarriers.add(o),Q(t.graphic,o);break}}}}(await this.view.whenLayerView(this.layer)).emit(t.type,t.type==="create"?ua(t):ya(t))}}initialize(){this._sketchViewModel=new da({layer:this._graphicsLayer,view:this.view}),this.addHandles([U(()=>this.enabled,e=>{e?this._activate():this._deactivate()},Et),U(()=>{const{stops:e,pointBarriers:t,polylineBarriers:a,polygonBarriers:i}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:a,polygonBarriers:i}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),bt(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=N(this._graphicsLayer),this._sketchViewModel=N(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>F(e))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case"stop":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const t=this._graphicsLayer.graphics.find(a=>F(a)===e);t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(t=>t.toArray().map(a=>{const i=a.toGraphic();return i.networkFeature=a,i}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};h([c()],x.prototype,"enabled",void 0),h([c({constructOnly:!0})],x.prototype,"layer",void 0),h([c({readOnly:!0})],x.prototype,"selectedNetworkFeatures",null),h([c()],x.prototype,"updating",null),h([c({constructOnly:!0})],x.prototype,"view",void 0),x=h([$("esri.views.2d.layers.support.RouteLayerInteraction")],x);const Da=Object.freeze(Object.defineProperty({__proto__:null,get RouteLayerInteraction(){return x}},Symbol.toStringTag,{value:"Module"}));export{f as P,Da as R,ee as a,Wt as b,zt as c,Jt as d,Re as e,wa as f,Qt as g,ea as h,ta as i,jt as j,Be as n,ie as o,oe as p,Xt as r,ia as s};
